Я разрабатываю приложение для улучшения опыта чтения под музыку. Вот сама суть идеи:

"""
Пользователь, добавив свой текст, читает только выделенную часть текста и сам переносит выделение вперёд/назад нажатиями кнопок. Музыка, также изначально выбранная и настроенная пользователем, проигрывается частями с автоматическим их выбором **под настроение выделенной части текста**, тем самым повторяя атмосферу книги, а не перебивая её.
# Решаемая проблема
Чтение книг и прослушивание музыки вместе, синхронно.

**Жизненная история:**

Вспомните людей, которые каждый день оставляют время на то, чтобы почитать какую-то книгу, когда обычный человек предпочёл бы весело провести время перед телевизором. В такие моменты появляется зависть и желание стать таким же. И спустя долгие дни вы всё же нашли время сесть за книгу, которую так давно хотели прочитать. Абзац за абзацем вы еле-еле удерживаете свою увлечённость за текстом, но тут кто-то что-то разбил на кухне вместе с вашим шатким вниманием. Недолго думая вы в панике начинаете пытаться восстановить увлечённость, но теперь вам мешает даже шум машин на улице! С последней надеждой вы включаете Яндекс музыку в наушниках, а через несколько песен фильтруете волну по трекам без слов. И вроде бы всё стало стабильно... кроме главного героя. Вам почему-то весело, а он страдает. Вы с яростью бросаете книгу, идёте на диван смотреть телевизор и ставите новое мнение о читающих людях: они занимаются непостижимым делом!

**Краткие проблемы:**

Читать в современности лень и скучно, легче посидеть на диване перед телевизором, ведь информацию можно извлечь и так. Но что же мы теряем оставляя книги в прошлом?

Во время чтения легко можно отвлечься и потерять смысл строк, а шумная окружающая среда только поможет вам в этом. Стоят ли книги усилий при прочтении?

Избегая окружающего шума во время чтения с музыкой можно перепутать эмоциональную окраску или отвлечься на любимую часть в треке. Грамотно ли вообще мешать музыку с чтением?

Со всеми этими проблемами легко справится в минималистичном приложении Lyrata, способном совместить эмоции вашей любимой музыки с читаемым текстом. Приложение всеми силами будет улучшать ваш опыт чтения.

**Сравнение с фильмами:**

Что лучше... прочесть книгу или просмотреть сериал?

Кино демонстрирует информацию быстрее и в более сжатом формате. Книги в свою очередь тратят одно и то же время по-очереди на действие, разговоры, описание окружения и эмоций, причём используя только текст, заставляя работать ваше воображение. Но и тот, и тот способы одинаково демонстрируют эмоциональную составляющую описываемой ситуации.

Кино сейчас явно популярнее, а всё из-за простоты восприятия... а также... из-за подходящего музыкального сопровождения. Вспомните легендарное кино с музыкой Ханса Циммера: "Интерстеллар", пересъёмка "Король лев", "Кунг фу панда" и другие. Музыка при чтении книг не совпадает с эмоциями строк, а больше путает чувства читателя, а при отсутствии песен может появится отвлекающий фактор окружающей среды, который будет действовать сильнее, чем в кино.

Lyrata поможет вам вернуться к книгам, путём добавления музыки синхронизированной с текстом. Совсем скоро можно будет читать в удовольствие что угодно!

**Решение:**

**Lyrata!** Давайте синхронизируем настроение текста с манером музыки, причём необязательно каких-то предустановленных наборов, а так, чтобы любой человек мог читать под свои интересы, а также с разделением музыки на части для более точной подачи настроения.
# Функционал приложения
Первая основная функция приложения: чтение текста, представленного в минималистичном стиле. Абзац или предложение будет подсвечиваться чёрным, когда пользователь его читает, или еле заметным серым, если эта часть текста сейчас не читается. Чёрный текст всегда по центру. Чтобы пользователю переключить абзац / предложение на следующий / предыдущий, используются соответствующие кнопки.

Вторая основная функция: музыка пользователя, подстраивающаяся под настроение текущего абзаца / предложения. Музыка выбирается из рекомендаций / плейлиста какого-то приложения (Яндекс музыки, например) или просто скачанной на устройство. Приложение само подбирает относительно спокойные или бодрые части песен под разные абзацы / предложения и переключает их при нажатии на кнопку (при необходимости).

Третья функция: вставка любого художественного текста. Пользователь сам может выбрать, что читать, хоть своё сочинение. Это позволяют сделать современные модели, классифицирующие текста.

# Предполагаемые части приложения
### Какова будет структура приложения?
Все эти части придётся создавать, возможно по-отдельности, используя какие-то технологии. И многие из них представляют интересную сферу анализа:
##### Текст
Основной функционал крутится вокруг вставленного пользователем текста. Он делится на переключаемые части, потом анализируется нейросетью на эмоциональную составляющую, а потом становится главным актёром на экране.
##### Музыка
Это уже главный актёр в наушниках. Музыка, также вставленная пользователем, проходит более сложный анализ на эмоциональность и разбивается на более мелкие части. Во время работы приложения они будут включаться в порядке зависящем от эмоции части текста.
##### Другие
Анализатор текста: текст будет анализироваться по частям. Как? Предстоит узнать.
Анализатор музыки: оптимизированные библиотеки для работы с аудио.
Механизм сопоставления: тегированные куски текста и музыки нужно красиво соотнести.
Пользовательский интерфейс: визуализация тоже потратит время разработки.
### Подробнее
##### Анализатор текста
Текст будет анализироваться по частям... как? Предстоит узнать. Но для этого будет использоваться предобученная модель, в основе которой будет лежать RuBERT классификатор текстов. Модель должна будет высказываться какие эмоции с каким шансом есть в данной части текста, а затем алгоритм выставит, какая музыка может быть включена на фоне во время чтения той или иной части текста. Предварительный анализ обученных моделей показывает, что эмоции как таковые распознавать не получится (либо в моделях нет контекста, а входной окно слишком маленькое, либо выходной слой содержит только данные о положительности текста).

##### Анализатор музыки
На популярных языках программирования уже есть хорошо оптимизированные аудио библиотеки, позволяющие анализировать звуковые файлы или музыку со всех сторон. При помощи них будут построены алгоритм разделения музыкального произведения на части, а также алгоритм классификации части, чтобы её можно было сопоставить с эмоцией в тексте. Классификация должна быть максимально точной, поэтому она будет далеко не любой.

##### Механизм сопоставления
Также есть часть, которая всё выше перечисленное объединяет. Каждая часть текста будет иметь свой тег, описывающий эмоциональную окраску. И если от одного куска текста к другому она не меняется, то и музыка будет оставаться соответствующей. А если меняется, то и музыка будет переключаться как минимум на более громкую / тихую, а как максимум по эмоции. Ещё здесь учитывается скорость чтения пользователя. Возможно алгоритм будет другой, но эта часть всё равно будет в приложении.

##### Пользовательский интерфейс
Важная визуальная часть, чтобы пользователь просто мог общаться с этой системой. Сюда входят отображение текста, меню, настроек...
"""

Также есть готовая часть. Я уже сделал интерфейс для чтения, а также парсилку файлов md, html и txt и на js (для первого тестового релиза, чтобы пользователи могли попробовать), и на python, для дальнейшего развития.

Я использую React+TypeScript на фронтенде, потом electron при сборке и доступу к файловой системе, python для глубокого анализа и текстов, и музыки. Python часть будет поставляться вместе с electron приложением. Т. е. бэкенд **встроен**. Связь налаживается при помощи ipc между electron-бэкендом и фронтендом, и при помощи HTTP между Python flask и фронтендом. Текст хранится в виде базы данных, где в таблице documents хранятся заголовки файлов (имя, идентификатор, время создания, точка остановки предыдущего чтения), а в таблице blocks хранятся построчно части текста (часть текста - это часть абзаца имеющая один стиль, либо блочная часть текста - как в html блок, описывающий что-то в структуре, либо стиле) - так иерархично хранится текст в формате похожем на html. Также каждая строка blocks содержит идентификатор, идентификатор своего документа, порядок в родителе, идентификатор родителя, а ещё есть поля для хранения атрибутов, текста и данных (заполняются после анализа текста).

Для анализа текста из базы данных извлекается чистый текст без форматирования, но с абзацами, потом (на Python) прокидывается через функцию, которая заполняет столбец базы данных с указанием, где начинается какое настроение текста.